let db=firebase.database();const Container=document.querySelector("#Container"),containerN=document.querySelector(".containerN");let contSondaggiB,contSondaggiA,preSondaggi,btnScelta,btnInviaScelta,contSondaggi=[],indexSondaggioInEsame=0;document.cookie="domain=http://google.com/; samesite=none; secure",db.ref("Sondaggi").once("value").then(e=>{let t,i=[];e.forEach(e=>{t=e.val(),i.push(e.key);let n=document.createElement("div");n.classList.add("contSondaggio"),contSondaggi.push(n),Container.appendChild(n);let o="";t.Opzioni.forEach(e=>{o+=`<a class="btnOpzioni btnUnselected btnSond${indexSondaggioInEsame}" href="javascript:void(0)">${e}</a>`}),n.innerHTML=`<div class="beforeS"></div><div class="preSondaggio"><h2 class="titolo&giorno">Sondaggio</br>~ ${t.Data} ~</h2></div><div class="sondaggio"><h2 class="titSondaggio">${t.Titolo}</h2><p class="infoSondaggio">${t.Descrizione}</p><div class="contOpzioni">${o}</div><div class="contInviaScelta"><a href="javascript:void(0)" class="inviaScelta">Invia</a><div class="bdr bdr1"></div><div class="bdr bdr2"></div><div class="bdr bdr3"></div><div class="bdr bdr4"></div></div></div><div class="afterS"></div>`,btnSelecting(document.querySelectorAll(`.btnSond${indexSondaggioInEsame}`)),indexSondaggioInEsame++}),contSondaggiB=document.querySelectorAll(".beforeS"),contSondaggiA=document.querySelectorAll(".afterS"),preSondaggi=document.querySelectorAll(".preSondaggio"),btnScelta=document.querySelectorAll(".btnOpzioni"),btnInviaScelta=document.querySelectorAll(".contInviaScelta"),toggleSond(),firebase.auth().getRedirectResult().then(function(e){let t=e.user;if(null==t&&btnInviaScelta.forEach(e=>{e.addEventListener("click",()=>{alert("Per effettuare il sondaggio devi accedere \ncon l'account istituzionale! (@ittgiorgi.edu.it)")})}),e.credential){e.credential.accessToken;if(btnLogin.innerHTML="LogOut",btnLogin.setAttribute("href","index.html"),null!=t){"ittgiorgi.edu.it"===t.email.split("@")[1]&&(document.querySelector(".compIn").style.height="0px",db.ref(`Users/${t.uid}`).update({Email:t.email,Nome:t.displayName,uid:t.uid,l:t.l,photoURL:t.photoURL}));let e=document.createElement("img");e.setAttribute("src",t.photoURL),e.classList.add("accountImg"),document.body.appendChild(e),btnInviaScelta.forEach((e,n)=>{e.addEventListener("click",()=>{if("ittgiorgi.edu.it"===t.email.split("@")[1]){let o=document.querySelectorAll(`.btnSond${n}`);db.ref(`Users/${t.uid}/SondaggiF/Sondaggio${n}`).once("value").then(a=>{a.val()?alert("Hai giÃ  votato a questo sondaggio!"):o.forEach((o,a)=>{4===o.classList.length&&(db.ref(`Sondaggi/${i[n]}/Voti/${a}/${t.uid}`).set({Email:t.email,Nome:t.displayName}),db.ref(`Users/${t.uid}/SondaggiF/Sondaggio${n}`).set(!0),e.innerHTML="Inviato!",e.classList.add("inviaScelta"))})})}else alert("Devi accedere \ncon l'account istituzionale! (@ittgiorgi.edu.it)")})})}}})});const btnLogin=document.querySelector("#btnLogin");let logged=void 0;btnLogin.addEventListener("click",()=>{null==logged&&firebase.auth().setPersistence(firebase.auth.Auth.Persistence.LOCAL).then(function(){var e=new firebase.auth.OAuthProvider("google.com");return e.addScope("profile"),e.addScope("email"),firebase.auth().signInWithRedirect(e)}).catch(function(e){})});